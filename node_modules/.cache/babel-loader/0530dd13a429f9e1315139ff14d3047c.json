{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/jackjoliet/Documents/marketplace/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component,Fragment}from'react';import{Link,withRouter}from'react-router-dom';import{connect}from\"react-redux\";import sumItems from'../../utils/sumItems';import getTotal from'../../utils/getTotal';import{db_get_products}from\"../../store/actions/products\";import{db_charge_customer}from'../../store/actions/orders';import moment from'moment';import empty from'is-empty';import Navbar from'../../components/Nav/Navbar';import Loading from'../../components/Graphics/Loading';import ErrorBanner from'../../components/Graphics/ErrorBanner';import CheckoutPay from'../../components/Forms/CheckoutPay';import ProductRow from'../../components/Forms/ProductRow';var Checkout=/*#__PURE__*/function(_Component){_inherits(Checkout,_Component);function Checkout(props){var _this;_classCallCheck(this,Checkout);_this=_possibleConstructorReturn(this,_getPrototypeOf(Checkout).call(this,props));_this.removeRow=function(i){_this.setState(_objectSpread({},_this.state,{products:_this.state.products.filter(function(product,index){return index!=i;}),data:_objectSpread({},_this.state.data,{amount:getTotal(_this.state.products.filter(function(product,index){return index!=i;}))})}));localStorage.setItem(\"products\",JSON.stringify(_this.state.products.filter(function(product,index){return index!=i;})));};_this.onDataChange=function(e){_this.setState(_objectSpread({},_this.state,{data:_objectSpread({},_this.state.data,_defineProperty({},e.target.id,e.target.value))}));};_this.checkEmpties=function(){var arr=[];var data=_this.state.data;for(var key in data){if(empty(data[key])){arr.push(key);}}if(empty(arr)){_this.setState(_objectSpread({},_this.state,{empties:true}));return true;}else{_this.setState(_objectSpread({},_this.state,{empties:false}));return false;}};_this.chargeCustomer=function _callee(data){var resp;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this.setState(_objectSpread({},_this.state,{loaded:false}));_context.next=3;return _regeneratorRuntime.awrap(_this.props.db_charge_customer(data));case 3:resp=_context.sent;if(resp.complete){_this.setState(_objectSpread({},_this.state,{loaded:true,products:[],done:true}));localStorage.setItem(\"products\",JSON.stringify([]));}else{_this.setState(_objectSpread({},_this.state,{loaded:true,error:resp.message}));}case 5:case\"end\":return _context.stop();}}});};_this.state={loaded:false,products:[],data:{name:'',phone:'',email:'',org:'',amount:0},error:'',empties:false,done:false};_this.checkEmpties=_this.checkEmpties.bind(_assertThisInitialized(_this));return _this;}_createClass(Checkout,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var products;return _regeneratorRuntime.async(function componentDidMount$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(this.props.db_get_products());case 2:if(!empty(localStorage.getItem(\"products\"))){_context2.next=6;break;}_context2.t0=[];_context2.next=9;break;case 6:_context2.next=8;return _regeneratorRuntime.awrap(JSON.parse(localStorage.getItem(\"products\")).map(function(pro){return Object.assign(pro,_this2.props.products.find(function(p){return pro.id==p.id;}));}).filter(function(product){return product.active;}));case 8:_context2.t0=_context2.sent;case 9:products=_context2.t0;localStorage.setItem(\"products\",JSON.stringify(products.filter(function(product){return product.active;})));this.setState({loaded:true,products:products,items:sumItems(products),data:_objectSpread({},this.state.data,{amount:getTotal(products)})});case 12:case\"end\":return _context2.stop();}}},null,this);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){if(this.state.data!=prevState.data){this.checkEmpties();}}},{key:\"render\",value:function render(){var _this3=this;var data=this.state.data;var product_list=this.state.products.map(function(product,i){return React.createElement(ProductRow,{product:product,key:i,removeRow:function removeRow(){return _this3.removeRow(i);}});});return React.createElement(Fragment,null,React.createElement(Navbar,{active:\"home\",items:sumItems(this.state.products),toCheckout:function toCheckout(){}}),!empty(this.state.error)&&React.createElement(ErrorBanner,{error:this.state.error,onHide:function onHide(){return _this3.setState(_objectSpread({},_this3.state,{error:''}));}}),!this.state.loaded&&React.createElement(Loading,null),this.state.loaded&&React.createElement(\"div\",{className:\"dashboard-container\"},!this.state.done&&React.createElement(\"div\",{className:\"dashboard-box\",style:{marginTop:\"1rem\"}},React.createElement(\"div\",{className:\"left-div\"},React.createElement(\"div\",{className:\"personal-info-container\"},React.createElement(\"h2\",{style:{margin:\"0\"}},\"Personal Info\"),React.createElement(\"span\",{style:{marginBottom:\"0.5rem\",fontSize:\"0.8rem\"}},\"*You must fill out all fields before proceeding to payment.\"),React.createElement(\"div\",{className:\"personal-info\"},React.createElement(\"div\",{className:\"info-side\"},React.createElement(\"label\",null,\"Name:\"),React.createElement(\"input\",{type:\"text\",id:\"name\",className:\"apparel-input\",value:data.name,onChange:this.onDataChange}),React.createElement(\"label\",null,\"Phone:\"),React.createElement(\"input\",{type:\"tel\",id:\"phone\",className:\"apparel-input\",value:data.phone,onChange:this.onDataChange})),React.createElement(\"div\",{className:\"info-side\"},React.createElement(\"label\",null,\"Email:\"),React.createElement(\"input\",{type:\"email\",id:\"email\",className:\"apparel-input\",value:data.email,onChange:this.onDataChange}),React.createElement(\"label\",null,\"Fraternity/Sorority:\"),React.createElement(\"input\",{type:\"text\",id:\"org\",className:\"apparel-input\",value:data.org,onChange:this.onDataChange})))),React.createElement(\"div\",{className:\"personal-info-container\",style:{marginBottom:\"0\"}},React.createElement(\"table\",{className:\"product-list\"},React.createElement(\"tbody\",{className:\"product-table-body\"},React.createElement(\"tr\",{className:\"product-header\"},React.createElement(\"th\",{className:\"product-head hide\"},\"Product\"),React.createElement(\"th\",{className:\"product-head\"},\"Name\"),React.createElement(\"th\",{className:\"product-head\",style:{textAlign:\"center\"}},\"Size\"),React.createElement(\"th\",{className:\"product-head\",style:{textAlign:\"center\"}},\"Quantity\"),React.createElement(\"th\",{className:\"product-head\"},\"Price\")),!empty(this.state.products)&&React.createElement(Fragment,null,product_list),empty(this.state.products)&&React.createElement(\"tr\",null,React.createElement(\"td\",{colSpan:\"5\"},\"There are no products in your cart.\")))))),React.createElement(\"div\",{className:\"checkout-box\"},React.createElement(\"span\",null,\"Total: $\",(getTotal(this.state.products)/100).toFixed(2)),React.createElement(\"span\",{style:{marginBottom:\"0.4rem\"}},\"Items: \",sumItems(this.state.products)),React.createElement(CheckoutPay,{disabled:!this.state.empties,amount:getTotal(this.state.products),data:_objectSpread({},data,{products:this.state.products}),chargeCustomer:this.chargeCustomer}))),this.state.done&&React.createElement(\"div\",{className:\"thank-you-div\"},React.createElement(\"span\",{style:{fontSize:\"2.7rem\",textAlign:\"center\"}},\"Thanks for reppin Phi Sig!\"),React.createElement(\"span\",{style:{fontSize:\"1.5rem\",textAlign:\"center\"}},\"Once the apparel arrives, the apparel chair will give you your items!\"))));}}]);return Checkout;}(Component);var mapStateToProps=function mapStateToProps(state){return{products:state.products};};export default connect(mapStateToProps,{db_get_products:db_get_products,db_charge_customer:db_charge_customer})(withRouter(Checkout));","map":{"version":3,"sources":["/Users/jackjoliet/Documents/marketplace/front/src/containers/Customer/Checkout.js"],"names":["React","Component","Fragment","Link","withRouter","connect","sumItems","getTotal","db_get_products","db_charge_customer","moment","empty","Navbar","Loading","ErrorBanner","CheckoutPay","ProductRow","Checkout","props","removeRow","i","setState","state","products","filter","product","index","data","amount","localStorage","setItem","JSON","stringify","onDataChange","e","target","id","value","checkEmpties","arr","key","push","empties","chargeCustomer","loaded","resp","complete","done","error","message","name","phone","email","org","bind","getItem","parse","map","pro","Object","assign","find","p","active","items","prevProps","prevState","product_list","marginTop","margin","marginBottom","fontSize","textAlign","toFixed","mapStateToProps"],"mappings":"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","sourcesContent":["import React, {Component, Fragment} from 'react';\nimport {Link, withRouter} from 'react-router-dom';\nimport {connect} from \"react-redux\";\nimport sumItems from '../../utils/sumItems';\nimport getTotal from '../../utils/getTotal';\nimport {db_get_products} from \"../../store/actions/products\";\nimport {db_charge_customer} from '../../store/actions/orders';\nimport moment from 'moment';\nimport empty from 'is-empty';\n\nimport Navbar from '../../components/Nav/Navbar';\nimport Loading from '../../components/Graphics/Loading';\nimport ErrorBanner from '../../components/Graphics/ErrorBanner';\nimport CheckoutPay from '../../components/Forms/CheckoutPay';\nimport ProductRow from '../../components/Forms/ProductRow';\n\nclass Checkout extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tloaded: false,\n      products: [],\n      data: {\n        name: '',\n        phone: '',\n        email: '',\n        org: '',\n        amount: 0\n      },\n      error: '',\n      empties: false,\n      done: false\n\t\t};\n    this.checkEmpties = this.checkEmpties.bind(this);\n\t}\n\n  async componentDidMount() {\n    await this.props.db_get_products();\n  \tconst products = empty(localStorage.getItem(\"products\")) ? [] : await JSON.parse(localStorage.getItem(\"products\")).map(pro => Object.assign(pro, this.props.products.find(p => pro.id == p.id))).filter(product => product.active);\n    localStorage.setItem(\"products\", JSON.stringify(products.filter(product => product.active)));\n    this.setState({\n      loaded: true,\n      products: products,\n      items: sumItems(products),\n      data: {\n        ...this.state.data,\n        amount: getTotal(products)\n      }\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if(this.state.data != prevState.data) {\n      this.checkEmpties();\n    }\n  }\n\n  removeRow = i => {\n    this.setState({\n      ...this.state,\n      products: this.state.products.filter((product, index) => index != i),\n      data: {\n        ...this.state.data,\n        amount: getTotal(this.state.products.filter((product, index) => index != i))\n      }\n    });\n    localStorage.setItem(\"products\", JSON.stringify(this.state.products.filter((product, index) => index != i)));\n  }\n\n  onDataChange = e => {\n    this.setState({\n      ...this.state,\n      data: {\n        ...this.state.data,\n        [e.target.id]: e.target.value \n      }\n    });\n  }\n\n  checkEmpties = () => {\n    let arr = [];\n    const {data} = this.state;\n    for (var key in data) {\n      if (empty(data[key])) {\n        arr.push(key);\n      }\n    }\n    if(empty(arr)) {\n      this.setState({\n        ...this.state,\n        empties: true\n      });\n      return true;\n    } else {\n      this.setState({\n        ...this.state,\n        empties: false\n      });\n      return false;\n    }\n  }\n\n  chargeCustomer = async data => {\n    this.setState({\n      ...this.state,\n      loaded: false\n    })\n    const resp = await this.props.db_charge_customer(data);\n    if(resp.complete) {\n      this.setState({...this.state, loaded: true, products: [], done: true});\n      localStorage.setItem(\"products\", JSON.stringify([]));\n    } else {\n      this.setState({\n        ...this.state,\n        loaded: true,\n        error: resp.message\n      });\n    }\n  }\n\n\trender() {\n    const {data} = this.state;\n\n    let product_list = this.state.products.map((product,i) => \n      <ProductRow \n        product={product}\n        key={i}\n        removeRow={() => this.removeRow(i)}\n      />\n    );\n\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t<Navbar active=\"home\" items={sumItems(this.state.products)} toCheckout={() => {}}/>\n        {!empty(this.state.error) && (<ErrorBanner error={this.state.error} onHide={() => this.setState({...this.state, error: ''})}/>)}\n        {!this.state.loaded && (<Loading />)}\n        {this.state.loaded && (<div className=\"dashboard-container\">\n          {!this.state.done && (<div className=\"dashboard-box\" style={{marginTop: \"1rem\"}}>\n            <div className=\"left-div\">\n              <div className=\"personal-info-container\">\n                <h2 style={{margin: \"0\"}}>Personal Info</h2>\n                <span style={{marginBottom: \"0.5rem\", fontSize: \"0.8rem\"}}>*You must fill out all fields before proceeding to payment.</span>\n                <div className=\"personal-info\">\n                  <div className=\"info-side\">\n                    <label>Name:</label>\n                    <input type=\"text\" id=\"name\" className=\"apparel-input\" value={data.name} onChange={this.onDataChange}/>\n                    <label>Phone:</label>\n                    <input type=\"tel\" id=\"phone\" className=\"apparel-input\" value={data.phone} onChange={this.onDataChange}/>\n                  </div>\n                  <div className=\"info-side\">\n                    <label>Email:</label>\n                    <input type=\"email\" id=\"email\" className=\"apparel-input\" value={data.email} onChange={this.onDataChange}/>\n                    <label>Fraternity/Sorority:</label>\n                    <input type=\"text\" id=\"org\" className=\"apparel-input\" value={data.org} onChange={this.onDataChange}/>\n                  </div>\n                </div>\n              </div>\n              <div className=\"personal-info-container\" style={{marginBottom: \"0\"}}>\n                <table className=\"product-list\">\n                  <tbody className=\"product-table-body\">\n                    <tr className=\"product-header\">\n                      <th className=\"product-head hide\">Product</th>\n                      <th className=\"product-head\">Name</th>\n                      <th className=\"product-head\" style={{textAlign: \"center\"}}>Size</th>\n                      <th className=\"product-head\" style={{textAlign: \"center\"}}>Quantity</th>\n                      <th className=\"product-head\">Price</th>\n                    </tr>\n                    {!empty(this.state.products) && (<Fragment>\n                      {product_list}\n                    </Fragment>)}\n                    {empty(this.state.products) && (<tr>\n                      <td colSpan=\"5\">There are no products in your cart.</td>\n                    </tr>)}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n            <div className=\"checkout-box\">\n              <span>Total: ${(getTotal(this.state.products) / 100).toFixed(2)}</span>\n              <span style={{marginBottom: \"0.4rem\"}}>Items: {sumItems(this.state.products)}</span>\n              <CheckoutPay disabled={!this.state.empties} amount={getTotal(this.state.products)} data={{...data, products: this.state.products}} chargeCustomer={this.chargeCustomer}/>\n            </div>\n          </div>)}\n          {this.state.done && (\n            <div className=\"thank-you-div\">\n              <span style={{fontSize: \"2.7rem\", textAlign: \"center\"}}>Thanks for reppin Phi Sig!</span>\n              <span style={{fontSize: \"1.5rem\", textAlign: \"center\"}}>Once the apparel arrives, the apparel chair will give you your items!</span>\n            </div>\n          )}\n        </div>)}\n\t\t\t</Fragment>\n\t\t)\n\t}\n}\n\nconst mapStateToProps = state => ({\n  products: state.products\n});\n\nexport default connect(mapStateToProps,{db_get_products, db_charge_customer})(withRouter(Checkout));\n\n\n"]},"metadata":{},"sourceType":"module"}